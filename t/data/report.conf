[Node::Report::Test]
type=sql
description=<<EOT
All currently known active nodes
EOT
columns=mac, ip, start_time, pid, detect_date, regdate, lastskip, status, user_agent, computername, notes, last_arp, last_dhcp, os
sql=<<EOT
BEGIN NOT ATOMIC
  SET @TENANT_ID = ?
  SELECT
    n.mac as mac,
    ip,
    start_time,
    pid,
    detect_date,
    regdate,
    lastskip,
    status,
    user_agent,
    computername,
    notes,
    last_arp,
    last_dhcp,
    device_type AS os
  FROM node n LEFT JOIN ip4log i USING (tenant_id, mac)
  WHERE
    n.tenant_id = @TENANT_ID AND
  (i.end_time = 0 OR i.end_time > NOW()) AND
    n.mac >= @CURSOR
    ORDER BY n.mac
    LIMIT 1;
END;
EOT
cursor_type=none
default_limit=100
has_limit=disabled
